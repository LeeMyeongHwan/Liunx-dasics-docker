ê¸°íš
ì‚¬ìš©ìì—ê²Œ ì‹¤ì§ˆì ìœ¼ë¡œ ë„ì›€ì´ ë˜ëŠ” ì‹¤ì‹œê°„ ë°ì´í„°ë¥¼ ì°¾ì•„ ë³´ì•˜ìŠµë‹ˆë‹¤.
ì˜ˆë¥¼ ë“¤ì–´ ì…êµ­ì¥ í˜¼ì¡ë„ APIëŠ” 
1. ê°€ì¡±ì„ ë§ˆì¤‘ ë‚˜ê°€ì•¼ í•  ë•Œ, í˜¼ì¡ë„ë¥¼ ë¯¸ë¦¬ í™•ì¸í•´ ì´ë™ ì‹œê°„ì„ ì¡°ì ˆ
2. í–‰ìë“¤ì´ ë„ì°© í›„ ì¶œêµ­ ì†Œìš” ì‹œê°„ ì˜ˆì¸¡ì— ë„ì›€
3. í•­ ìš´ì˜ìë‚˜ ì•ˆë‚´ ì¸ë ¥ì´ ì‹¤ì‹œê°„ ìƒí™©ì„ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ë°ë„ í™œìš© ê°€ëŠ¥
ì´ëŸ¬í•œ ìƒí™©ì—ì„œ ìœ ìš©í•˜ê²Œ ì“°ì¼ ìˆ˜ ìˆë‹¤ê³  ìƒê°í•´ ì´ APIì„ ì„ ì •í–ˆìŠµë‹ˆë‹¤. 

êµ¬í˜„ì„¤ëª…
update_html.sh
ì…êµ­ì¥ í˜¼ì¡ë„ APIë¥¼ í˜¸ì¶œí•˜ê³ , HTML í…Œì´ë¸”ì„ ìƒì„±í•´ index.htmlë¡œ ì €ì¥í•˜ë©°, ê¸°ì¡´ íŒŒì¼ì€ ë°±ì—…í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

SERVICE_KEY="..."      # ê³µê³µë°ì´í„° API í‚¤
TERM_LIST="T1 T2"      # ì¡°íšŒí•  í„°ë¯¸ë„ ë¦¬ìŠ¤íŠ¸
OUTPUT_FILE="/usr/share/nginx/html/index.html"
ì‚¬ìš©í•  API í‚¤, í„°ë¯¸ë„ ë¦¬ìŠ¤íŠ¸, ì¶œë ¥ íŒŒì¼ ê²½ë¡œ ì„¤ì •

mkdir -p "$(dirname "$OUTPUT_FILE")"
BACKUP_DIR="/usr/share/nginx/html/backups"
mkdir -p "$BACKUP_DIR"
index.htmlê³¼ backups/ í´ë”ê°€ ì—†ìœ¼ë©´ ìë™ ìƒì„±

íŒŒì¼ ë°±ì—…
if [ -f "$OUTPUT_FILE" ]; then
  cp "$OUTPUT_FILE" "$BACKUP_DIR/index_$(date +%Y%m%d_%H%M%S).html"
fi
index.htmlì´ ì¡´ì¬í•˜ë©´ ë°±ì—… ë””ë ‰í† ë¦¬ì— íƒ€ì„ìŠ¤íƒ¬í”„ íŒŒì¼ë¡œ ì €ì¥

 HTML
NOW=$(date "+%Y-%m-%d %H:%M:%S")
echo "updated at $(date)" >> /usr/share/nginx/html/cron.log
í˜„ì¬ ì‹œê°ì„ ë³€ìˆ˜ì— ì €ì¥, ë¡œê·¸ë¡œ ë‚¨ê¹€

cat <<EOF > "$OUTPUT_FILE"
<html>
<head>
  <meta charset="UTF-8">
  <title>ì…êµ­ì¥ í˜¼ì¡ë„</title>
  <style>
    body { font-family: sans-serif; }
    p { margin: 0.5em 0; }
    .notice { font-size: 1em; color: gray; }
  </style>
</head>
<body>
  <h1>ì…êµ­ì¥ í˜¼ì¡ë„ í˜„í™©</h1>
  <p class="notice">
  ğŸ“ <a href="/backups/">ì´ì „ ë°±ì—… ëª©ë¡ ë³´ê¸°</a>
  </p>
  <table border="1" cellpadding="5" cellspacing="0">
    <tr>
      <th>í„°ë¯¸ë„</th><th>ì…êµ­ì¥</th><th>í¸ëª…</th><th>ë„ì°©ì˜ˆì •</th>
      <th>ë„ì°©ì‹¤ì œ</th><th>ë‚´êµ­ì¸</th><th>ì™¸êµ­ì¸</th>
    </tr>
EOF
HTML í‹€, ë°±ì—… ë³´ê¸° ë§í¬ë„ HTMLë„ í¬í•¨

API í˜¸ì¶œ ë° ë°ì´í„° íŒŒì‹±
for T in $TERM_LIST; do
    curl -s "http://apis.data.go.kr/...&terno=${T}" > /tmp/res.xml
í„°ë¯¸ë„(T1, T2) ë³„ë¡œ API í˜¸ì¶œ â†’ ì‘ë‹µì„ res.xmlë¡œ ì €ì¥

    COUNT=$(xmllint --xpath 'count(//item)' /tmp/res.xml)
    i=1
    while [ $i -le $COUNT ]; do
XML ë‚´ <item> ìš”ì†Œ ê°œìˆ˜ë¥¼ ì„¸ê³  ë°˜ë³µí•  ì¤€ë¹„

XML í•­ëª© ì¶”ì¶œ ë° HTML í–‰ ì‘ì„±
        ENTRYGATE=$(xmllint --xpath "string(//item[$i]/entrygate)" /tmp/res.xml)
        FLIGHTID=$(xmllint --xpath "string(//item[$i]/flightid)" /tmp/res.xml)
        SCHEDULE=$(xmllint --xpath "string(//item[$i]/scheduletime)" /tmp/res.xml)
        ESTIMATE=$(xmllint --xpath "string(//item[$i]/estimatedtime)" /tmp/res.xml)
        KOREAN=$(xmllint --xpath "string(//item[$i]/korean)" /tmp/res.xml)
        FOREIGNER=$(xmllint --xpath "string(//item[$i]/foreigner)" /tmp/res.xml)
xmllintë¥¼ ì‚¬ìš©í•´ XMLì—ì„œ ë°ì´í„° ì¶”ì¶œ
//item[i]/... í˜•íƒœë¡œ ê°ê° í•„ìš”í•œ ì •ë³´ë¥¼ ì½ì–´ì˜´

        echo "    <tr><td>$T</td><td>$ENTRYGATE</td><td>$FLIGHTID</td><td>$SCHEDULE</td><td>$ESTIMATE</td><td>$KOREAN</td><td>$FOREIGNER</td></tr>" >> "$OUTPUT_FILE"
        i=$((i + 1))
    done
done
ì¶”ì¶œí•œ ë°ì´í„°ë¥¼ HTML í…Œì´ë¸” <tr> í˜•ì‹ìœ¼ë¡œ ì‘ì„±

HTML ë§ˆë¬´ë¦¬ ë° ë°±ì—… ë°˜ë³µ
cat <<EOF >> "$OUTPUT_FILE"
  </table>
  <p class="notice">
    ğŸ“ <a href="/backups/">ì´ì „ ë°±ì—… ëª©ë¡ ë³´ê¸°</a>
  </p>
</body>
</html>
EOF
ë°±ì—… ë§í¬ í•œ ë²ˆ ë” ì¶œë ¥ (ìœ„/ì•„ë˜ ëª¨ë‘ ìˆìŒ)

cp "$OUTPUT_FILE" "$BACKUP_DIR/index_$(date +%Y%m%d_%H%M%S).html"
index.html ë°±ì—… (ì•ˆì „ì„± í–¥ìƒ)

nginx.conf
/ â†’ index.html
/backups/ â†’ /usr/share/nginx/html/backupsì— ì ‘ê·¼ (autoindex í™œì„±í™”)

mycron
* * * * * /usr/local/bin/update_html.sh
ìœ„ì˜ ì‰˜ ìŠ¤í¬ë¦½íŠ¸ë¥¼ 1ë¶„ë§ˆë‹¤ ìë™ ì‹¤í–‰ì‹œí‚´

